(function(b){b.fn.editable=function(a){if(a=="disable")return this.unbind(this.data("editable.options").editBy,this.data("editable.options").toEditable);if(a=="enable")return this.bind(this.data("editable.options").editBy,this.data("editable.options").toEditable);if(a=="destroy")return this.unbind(this.data("editable.options").editBy,this.data("editable.options").toEditable).data("editable.previous",null).data("editable.current",null).data("editable.options",null);a=b.extend({onEdit:null,onSubmit:null,
onCancel:null,editClass:null,submit:null,cancel:null,type:"text",submitBy:"blur",editBy:"click",options:null},a);a.toEditable=function(){$this=b(this);$this.data("editable.current",$this.html());opts=$this.data("editable.options");b.editableFactory[opts.type].toEditable($this.empty(),opts);$this.data("editable.previous",$this.data("editable.current")).children().focus().addClass(opts.editClass);opts.submit?b("<button/>").appendTo($this).html(opts.submit).one("mouseup",function(){opts.toNonEditable(b(this).parent(),
true)}):$this.one(opts.submitBy,function(){opts.toNonEditable(b(this),true)}).children().one(opts.submitBy,function(){opts.toNonEditable(b(this).parent(),true)});opts.cancel&&b("<button/>").appendTo($this).html(opts.cancel).one("mouseup",function(){opts.toNonEditable(b(this).parent(),false)});b.isFunction(opts.onEdit)&&opts.onEdit.apply($this,[{current:$this.data("editable.current"),previous:$this.data("editable.previous")}])};a.toNonEditable=function(c,d){opts=c.data("editable.options");c.one(opts.editBy,
opts.toEditable).data("editable.current",d?b.editableFactory[opts.type].getValue(c,opts):c.data("editable.current")).html(opts.type=="password"?"*****":c.data("editable.current"));var e=null;if(b.isFunction(opts.onSubmit)&&d==true)e=opts.onSubmit;else if(b.isFunction(opts.onCancel)&&d==false)e=opts.onCancel;e!=null&&e.apply(c,[{current:c.data("editable.current"),previous:c.data("editable.previous")}])};this.data("editable.options",a);return this.one(a.editBy,a.toEditable)};b.editableFactory={text:{toEditable:function(a){b("<input/>").appendTo(a).val(a.data("editable.current"))},
getValue:function(a){return a.children().val()}},password:{toEditable:function(a){a.data("editable.current",a.data("editable.password"));a.data("editable.previous",a.data("editable.password"));b('<input type="password"/>').appendTo(a).val(a.data("editable.current"))},getValue:function(a){a.data("editable.password",a.children().val());return a.children().val()}},textarea:{toEditable:function(a){b("<textarea/>").appendTo(a).val(a.data("editable.current"))},getValue:function(a){return a.children().val()}},
select:{toEditable:function(a,c){$select=b("<select/>").appendTo(a);b.each(c.options,function(d,e){b("<option/>").appendTo($select).html(e).attr("value",d)});$select.children().each(function(){var d=b(this);if(d.text()==a.data("editable.current"))return d.attr("selected","selected").text()})},getValue:function(a){var c=null;b("select",a).children().each(function(){if(b(this).attr("selected"))return c=b(this).text()});return c}}}})(jQuery);
