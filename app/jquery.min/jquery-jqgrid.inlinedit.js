(function(a){a.jgrid.extend({editRow:function(d,u,h,p,l,v,t,c,f){return this.each(function(){var b=this,j,q,s=0,m=null,n={},e,o;if(b.grid){e=a(b).jqGrid("getInd",d,true);if(e!=false)if((a(e).attr("editable")||"0")=="0"&&!a(e).hasClass("not-editable-row")){o=b.p.colModel;a("td",e).each(function(g){j=o[g].name;var k=b.p.treeGrid===true&&j==b.p.ExpandColumn;if(k)q=a("span:first",this).html();else try{q=a.unformat(this,{colModel:o[g]},g)}catch(i){q=a(this).html()}if(j!="cb"&&j!="subgrid"&&j!="rn"){n[j]=
q;if(o[g].editable===true){if(m===null)m=g;k?a("span:first",this).html(""):a(this).html("");var r=a.extend({},o[g].editoptions||{},{id:d+"_"+j,name:j});if(!o[g].edittype)o[g].edittype="text";r=createEl(o[g].edittype,r,q,true,a.extend({},a.jgrid.ajaxOptions,b.p.ajaxSelectOptions||{}));a(r).addClass("editable");k?a("span:first",this).append(r):a(this).append(r);o[g].edittype=="select"&&o[g].editoptions.multiple===true&&a.browser.msie&&a(r).width(a(r).width());s++}}});if(s>0){n.id=d;b.p.savedRow.push(n);
a(e).attr("editable","1");a("td:eq("+m+") input",e).focus();u===true&&a(e).bind("keydown",function(g){g.keyCode===27&&a(b).jqGrid("restoreRow",d,f);if(g.keyCode===13){a(b).jqGrid("saveRow",d,p,l,v,t,c,f);return false}g.stopPropagation()});a.isFunction(h)&&h(d)}}}})},saveRow:function(d,u,h,p,l,v,t){return this.each(function(){var c=this,f,b={},j={},q,s,m,n;if(c.grid){n=a(c).jqGrid("getInd",d,true);if(n!=false){q=a(n).attr("editable");h=h?h:c.p.editurl;if(q==="1"&&h){var e;a("td",n).each(function(k){e=
c.p.colModel[k];f=e.name;if(f!="cb"&&f!="subgrid"&&e.editable===true&&f!="rn"){switch(e.edittype){case "checkbox":var i=["Yes","No"];if(e.editoptions)i=e.editoptions.value.split(":");b[f]=a("input",this).attr("checked")?i[0]:i[1];break;case "text":case "password":case "textarea":case "button":b[f]=!c.p.autoencode?a("input, textarea",this).val():a.jgrid.htmlEncode(a("input, textarea",this).val());break;case "select":if(e.editoptions.multiple){i=a("select",this);var r=[];b[f]=a(i).val();b[f]=b[f]?b[f].join(","):
"";a("select > option:selected",this).each(function(x,y){r[x]=a(y).text()});j[f]=r.join(",")}else{b[f]=a("select>option:selected",this).val();j[f]=a("select>option:selected",this).text()}if(e.formatter&&e.formatter=="select")j={};break;case "custom":try{if(e.editoptions&&a.isFunction(e.editoptions.custom_value)){b[f]=e.editoptions.custom_value(a(".customelement",this),"get");if(b[f]===undefined)throw"e2";}else throw"e1";}catch(w){w=="e1"&&info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+
a.jgrid.edit.msg.nodefined,jQuery.jgrid.edit.bClose);w=="e2"?info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+a.jgrid.edit.msg.novalue,jQuery.jgrid.edit.bClose):info_dialog(jQuery.jgrid.errors.errcap,w.message,jQuery.jgrid.edit.bClose)}break}m=checkValues(b[f],k,c);if(m[0]===false){m[1]=b[f]+" "+m[1];return false}}});if(m[0]===false)try{info_dialog(a.jgrid.errors.errcap,m[1],a.jgrid.edit.bClose)}catch(o){alert(m[1])}else{if(b){b.id=d;if(p)b=a.extend({},b,p)}if(!c.grid.hDiv.loading){c.grid.hDiv.loading=
true;a("div.loading",c.grid.hDiv).fadeIn("fast");if(h=="clientArray"){b=a.extend({},b,j);q=a(c).jqGrid("setRowData",d,b);a(n).attr("editable","0");for(var g=0;g<c.p.savedRow.length;g++)if(c.p.savedRow[g].id==d){s=g;break}s>=0&&c.p.savedRow.splice(s,1);a.isFunction(l)&&l(d,q)}else a.ajax(a.extend({url:h,data:a.isFunction(c.p.serializeRowData)?c.p.serializeRowData(b):b,type:"POST",complete:function(k,i){if(i==="success")if((a.isFunction(u)?u(k):true)===true){b=a.extend({},b,j);a(c).jqGrid("setRowData",
d,b);a(n).attr("editable","0");for(i=0;i<c.p.savedRow.length;i++)if(c.p.savedRow[i].id==d){s=i;break}s>=0&&c.p.savedRow.splice(s,1);a.isFunction(l)&&l(d,k)}else a(c).jqGrid("restoreRow",d,t)},error:function(k,i){a.isFunction(v)?v(d,k,i):alert("Error Row: "+d+" Result: "+k.status+":"+k.statusText+" Status: "+i)}},a.jgrid.ajaxOptions,c.p.ajaxRowOptions||{}));c.grid.hDiv.loading=false;a("div.loading",c.grid.hDiv).fadeOut("fast");a(n).unbind("keydown")}}}}}})},restoreRow:function(d,u){return this.each(function(){var h=
this,p,l,v={};if(h.grid){l=a(h).jqGrid("getInd",d,true);if(l!=false){for(var t=0;t<h.p.savedRow.length;t++)if(h.p.savedRow[t].id==d){p=t;break}if(p>=0){if(a.isFunction(a.fn.datepicker))try{a("input.hasDatepicker","#"+l.id).datepicker("hide")}catch(c){}a.each(h.p.colModel,function(){if(this.editable==true&&this.name in h.p.savedRow[p])v[this.name]=h.p.savedRow[p][this.name]});a(h).jqGrid("setRowData",d,v);a(l).attr("editable","0").unbind("keydown");h.p.savedRow.splice(p,1)}a.isFunction(u)&&u(d)}}})}})})(jQuery);
