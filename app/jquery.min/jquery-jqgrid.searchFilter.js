jQuery.fn.searchFilter=function(h,B){function C(c,i,k){this.$=c;this.add=function(a){a==null?c.find(".ui-add-last").click():c.find(".sf:eq("+a+") .ui-add").click();return this};this.del=function(a){a==null?c.find(".sf:last .ui-del").click():c.find(".sf:eq("+a+") .ui-del").click();return this};this.search=function(){c.find(".ui-search").click();return this};this.reset=function(){c.find(".ui-reset").click();return this};this.close=function(){c.find(".ui-closer").click();return this};if(i!=null){function w(){jQuery(this).toggleClass("ui-state-hover");
return false}function x(a){jQuery(this).toggleClass("ui-state-active",a.type=="mousedown");return false}function l(a,b){return"<option value='"+a+"'>"+b+"</option>"}function t(a,b,e){return"<select class='"+a+"'"+(e?" style='display:none;'":"")+">"+b+"</select>"}function y(a,b){a=c.find("tr.sf td.data "+a);a[0]!=null&&b(a)}function z(a,b){var e=c.find("tr.sf td.data "+a);e[0]!=null&&jQuery.each(b,function(){this.data!=null?e.bind(this.type,this.data,this.fn):e.bind(this.type,this.fn)})}var d=jQuery.extend({},
jQuery.fn.searchFilter.defaults,k),m=-1,q="";jQuery.each(d.groupOps,function(){q+=l(this.op,this.text)});q="<select name='groupOp'>"+q+"</select>";c.html("").addClass("ui-searchFilter").append("<div class='ui-widget-overlay' style='z-index: -1'>&#160;</div><table class='ui-widget-content ui-corner-all'><thead><tr><td colspan='5' class='ui-widget-header ui-corner-all' style='line-height: 18px;'><div class='ui-closer ui-state-default ui-corner-all ui-helper-clearfix' style='float: right;'><span class='ui-icon ui-icon-close'></span></div>"+
d.windowTitle+"</td></tr></thead><tbody><tr class='sf'><td class='fields'></td><td class='ops'></td><td class='data'></td><td><div class='ui-del ui-state-default ui-corner-all'><span class='ui-icon ui-icon-minus'></span></div></td><td><div class='ui-add ui-state-default ui-corner-all'><span class='ui-icon ui-icon-plus'></span></div></td></tr><tr><td colspan='5' class='divider'><div>&#160;</div></td></tr></tbody><tfoot><tr><td colspan='3'><span class='ui-reset ui-state-default ui-corner-all' style='display: inline-block; float: left;'><span class='ui-icon ui-icon-arrowreturnthick-1-w' style='float: left;'></span><span style='line-height: 18px; padding: 0 7px 0 3px;'>"+
d.resetText+"</span></span><span class='ui-search ui-state-default ui-corner-all' style='display: inline-block; float: right;'><span class='ui-icon ui-icon-search' style='float: left;'></span><span style='line-height: 18px; padding: 0 7px 0 3px;'>"+d.searchText+"</span></span><span class='matchText'>"+d.matchText+"</span> "+q+" <span class='rulesText'>"+d.rulesText+"</span></td><td>&#160;</td><td><div class='ui-add-last ui-state-default ui-corner-all'><span class='ui-icon ui-icon-plusthick'></span></div></td></tr></tfoot></table>");
k=c.find("tr.sf");var A=k.find("td.fields"),u=k.find("td.ops"),n=k.find("td.data"),r="";jQuery.each(d.operators,function(){r+=l(this.op,this.text)});r=t("default",r,true);u.append(r);n.append("<input type='text' class='default' style='display:none;' />");var s="",v=false,o=false;jQuery.each(i,function(a){s+=l(this.itemval,this.text);if(this.ops!=null){v=true;var b="";jQuery.each(this.ops,function(){b+=l(this.op,this.text)});b=t("field"+a,b,true);u.append(b)}if(this.dataUrl!=null){if(a>m)m=a;o=true;
var e=this.dataEvents,j=this.dataInit,p=this.buildSelect;jQuery.ajax(jQuery.extend({url:this.dataUrl,complete:function(f){f=p!=null?jQuery("<div />").append(p(f)):jQuery("<div />").append(f.responseText);f.find("select").addClass("field"+a).hide();n.append(f.html());j&&y(".field"+a,j);e&&z(".field"+a,e);a==m&&c.find("tr.sf td.fields select[name='field']").change()}},d.ajaxSelectOptions))}else if(this.dataValues!=null){o=true;var g="";jQuery.each(this.dataValues,function(){g+=l(this.value,this.text)});
g=t("field"+a,g,true);n.append(g)}else if(this.dataEvents!=null||this.dataInit!=null){o=true;g="<input type='text' class='field"+a+"' />";n.append(g)}this.dataInit!=null&&a!=m&&y(".field"+a,this.dataInit);this.dataEvents!=null&&a!=m&&z(".field"+a,this.dataEvents)});s="<select name='field'>"+s+"</select>";A.append(s);i=A.find("select[name='field']");v?i.change(function(a){var b=a.target.selectedIndex;a=jQuery(a.target).parents("tr.sf").find("td.ops");a.find("select").removeAttr("name").hide();b=a.find(".field"+
b);if(b[0]==null)b=a.find(".default");b.attr("name","op").show()}):u.find(".default").attr("name","op").show();o?i.change(function(a){var b=a.target.selectedIndex;a=jQuery(a.target).parents("tr.sf").find("td.data");a.find("select,input").removeClass("vdata").hide();b=a.find(".field"+b);if(b[0]==null)b=a.find(".default");b.show().addClass("vdata")}):n.find(".default").show().addClass("vdata");if(v||o)i.change();c.find(".ui-state-default").hover(w,w).mousedown(x).mouseup(x);c.find(".ui-closer").click(function(){d.onClose(jQuery(c.selector));
return false});c.find(".ui-del").click(function(a){a=jQuery(a.target).parents(".sf");if(a.siblings(".sf").length>0){d.datepickerFix===true&&jQuery.fn.datepicker!==undefined&&a.find(".hasDatepicker").datepicker("destroy");a.remove()}else{a.find("select[name='field']")[0].selectedIndex=0;a.find("select[name='op']")[0].selectedIndex=0;a.find(".data input").val("");a.find(".data select").each(function(){this.selectedIndex=0});a.find("select[name='field']").change()}return false});c.find(".ui-add").click(function(a){a=
jQuery(a.target).parents(".sf");var b=a.clone(true).insertAfter(a);b.find(".ui-state-default").removeClass("ui-state-hover ui-state-active");if(d.clone){b.find("select[name='field']")[0].selectedIndex=a.find("select[name='field']")[0].selectedIndex;if(b.find("select[name='op']")[0]!=null)b.find("select[name='op']").focus()[0].selectedIndex=a.find("select[name='op']")[0].selectedIndex;var e=b.find("select.vdata");if(e[0]!=null)e[0].selectedIndex=a.find("select.vdata")[0].selectedIndex}else{b.find(".data input").val("");
b.find("select[name='field']").focus()}d.datepickerFix===true&&jQuery.fn.datepicker!==undefined&&a.find(".hasDatepicker").each(function(){var j=jQuery.data(this,"datepicker").settings;b.find("#"+this.id).unbind().removeAttr("id").removeClass("hasDatepicker").datepicker(j)});b.find("select[name='field']").change();return false});c.find(".ui-search").click(function(){var a=jQuery(c.selector),b,e=a.find("select[name='groupOp'] :selected").val();b=d.stringResult?'{"groupOp":"'+e+'","rules":[':{groupOp:e,
rules:[]};a.find(".sf").each(function(j){var p=jQuery(this).find("select[name='field'] :selected").val(),g=jQuery(this).find("select[name='op'] :selected").val(),f=jQuery(this).find("input.vdata,select.vdata :selected").val();f+="";f=f.replace(/\\/g,"\\\\").replace(/\"/g,'\\"');if(d.stringResult){if(j>0)b+=",";b+='{"field":"'+p+'",';b+='"op":"'+g+'",';b+='"data":"'+f+'"}'}else b.rules.push({field:p,op:g,data:f})});if(d.stringResult)b+="]}";d.onSearch(b);return false});c.find(".ui-reset").click(function(){var a=
jQuery(c.selector);a.find(".ui-del").click();a.find("select[name='groupOp']")[0].selectedIndex=0;d.onReset();return false});c.find(".ui-add-last").click(function(){var a=jQuery(c.selector+" .sf:last"),b=a.clone(true).insertAfter(a);b.find(".ui-state-default").removeClass("ui-state-hover ui-state-active");b.find(".data input").val("");b.find("select[name='field']").focus();d.datepickerFix===true&&jQuery.fn.datepicker!==undefined&&a.find(".hasDatepicker").each(function(){var e=jQuery.data(this,"datepicker").settings;
b.find("#"+this.id).unbind().removeAttr("id").removeClass("hasDatepicker").datepicker(e)});b.find("select[name='field']").change();return false})}}return new C(this,h,B)};jQuery.fn.searchFilter.version="1.2.9";
jQuery.fn.searchFilter.defaults={clone:true,datepickerFix:true,onReset:function(h){alert("Reset Clicked. Data Returned: "+h)},onSearch:function(h){alert("Search Clicked. Data Returned: "+h)},onClose:function(h){h.hide()},groupOps:[{op:"AND",text:"all"},{op:"OR",text:"any"}],operators:[{op:"eq",text:"is equal to"},{op:"ne",text:"is not equal to"},{op:"lt",text:"is less than"},{op:"le",text:"is less or equal to"},{op:"gt",text:"is greater than"},{op:"ge",text:"is greater or equal to"},{op:"in",text:"is in"},
{op:"ni",text:"is not in"},{op:"bw",text:"begins with"},{op:"bn",text:"does not begin with"},{op:"ew",text:"ends with"},{op:"en",text:"does not end with"},{op:"cn",text:"contains"},{op:"nc",text:"does not contain"}],matchText:"match",rulesText:"rules",resetText:"Reset",searchText:"Search",stringResult:true,windowTitle:"Search Rules",ajaxSelectOptions:{}};
