(function(){function E(g,h,p,m){var a=this,y={datatype:F,viewrecords:true},u={edit:false,add:false,del:false,afterRefresh:function(){a.refreshData();a.jqgrid.object.trigger("reloadGrid")}};g=g;h=h;this.configuration=p;this.operations=m;this.jqgrid={id:null,object:null,options:null,last_selected_row:null,editable_columns:[],dirty_fields:{},pager:{id:null,options:null}};this.data={data:[],all_data:[],filtered_data:null};var v={enableDisableButtons:function(b){return function(d){function e(k){var j=
jQuery("#"+b.jqgrid.id).jqGrid("getRowData",k),q=t.from(b.data.all_data).equals("columns.key",j.key).select()[0];if(b.jqgrid.dirty_fields[j.key]===undefined)b.jqgrid.dirty_fields[j.key]=[];var f=[],i=[];jQuery.each(j,function(n,l){l!=q.columns[n]?f.push(n):i.push(n)});jQuery.each(f,function(n,l){jQuery.inArray(l,b.jqgrid.dirty_fields[j.key])===-1&&b.jqgrid.dirty_fields[j.key].push(l)});jQuery.each(i,function(n,l){n=jQuery.inArray(l,b.jqgrid.dirty_fields[j.key]);n!==-1&&b.jqgrid.dirty_fields[j.key].splice(n,
1)});b.jqgrid.dirty_fields[j.key].length===0&&delete b.jqgrid.dirty_fields[j.key];jQuery.each(b.operations.buttons,function(n,l){if(l.type==="post_edit"){n=jQuery("#"+b.jqgrid.id+"_buttonOp_"+l.id);C(b.jqgrid.dirty_fields)?n.attr("disabled","disabled"):n.removeAttr("disabled")}})}var r=b.jqgrid.object.jqGrid("getGridParam","multiselect")?"selarrrow":"selrow",c=b.jqgrid.object.jqGrid("getGridParam",r);if(!c instanceof Array)c=[c];if(c.length===1)if(d&&d!==b.jqgrid.last_selected_row){jQuery("#"+b.jqgrid.id).restoreRow(b.jqgrid.last_selected_row);
jQuery("#"+b.jqgrid.id).jqGrid("editRow",d,true,null,null,"clientArray",null,e);b.jqgrid.last_selected_row=d}jQuery.each(b.operations.buttons,function(k,j){k=jQuery("#"+b.jqgrid.id+"_buttonOp_"+j.id);if(j.type!=="post_edit")if(c.length>=j.real_bounds[0]&&c.length<=j.real_bounds[1]){k.removeAttr("disabled");if(j.real_bounds[0]===1&&j.real_bounds[1]===1&&k.data("melange")!==undefined){var q=b.jqgrid.object.jqGrid("getRowData",c[0]);q=t.from(b.data.all_data).equals("columns.key",q.key).select()[0];var f=
k.data("melange").click;k.click(f(q.operations.buttons[j.id].link));k.attr("value",q.operations.buttons[j.id].caption)}}else k.attr("disabled","disabled")})}}(a),global_button_functions:{redirect_simple:function(b){return b.new_window?function(){window.open(b.link)}:function(){window.location.href=b.link}},redirect_custom:function(b){return function(d){return b.new_window?function(){window.open(d)}:function(){window.location.href=d}}},post:function(b){return function(){var d=o.get(b.idx).jqgrid.object.jqGrid("getGridParam",
"multiselect")?"selarrrow":"selrow";d=o.get(b.idx).jqgrid.object.jqGrid("getGridParam",d);d instanceof Array||(d=d===null?[]:[d]);var e=[];if(!(d.length<b.real_bounds[0]||d.length>b.real_bounds[1])){jQuery.each(d,function(r,c){var k=jQuery("#"+o.get(b.idx).jqgrid.id).jqGrid("getRowData",c);t.from(o.get(b.idx).all_data).equals("columns.key",k.key).select();var j={};jQuery.each(b.keys,function(q,f){j[f]=k[f]});e.push(j)});if(b.url==="")b.url=window.location.href;jQuery.post(b.url,{xsrf_token:window.xsrf_token,
idx:b.idx,button_id:b.button_id,data:JSON.stringify(e)},function(r){if(b.redirect=="true")try{var c=JSON.parse(r);if(c.data.url!==undefined)window.location.href=c.data.url}catch(k){}if(b.refresh=="table"){o.get(b.idx).refreshData();jQuery("#"+o.get(b.idx).jqgrid.id).trigger("reloadGrid")}})}}},post_edit:function(b){return function(){var d=o.get(b.idx).jqgrid,e={};if(!(d.editable_columns.length===0&&C(d.dirty_fields))){for(var r=d.object.jqGrid("getGridParam","records"),c=1;c<=r;c++){var k=jQuery("#"+
d.id).jqGrid("getRowData",c);if(d.dirty_fields[k.key]!==undefined){e[k.key]={};jQuery.each(d.dirty_fields[k.key],function(j,q){e[k.key][q]=k[q]})}}if(b.url==="")b.url=window.location.href;jQuery.post(b.url,{xsrf_token:window.xsrf_token,idx:b.idx,button_id:b.button_id,data:JSON.stringify(e)},function(j){if(b.redirect=="true")try{var q=JSON.parse(j);if(q.data.url!==undefined)window.location.href=q.data.url}catch(f){}if(b.refresh=="table"){o.get(b.idx).refreshData();jQuery("#"+o.get(b.idx).jqgrid.id).trigger("reloadGrid")}})}}}},
row_functions:{redirect_custom:function(b){return function(d,e){return b.new_window||e.which===2||e.which===1&&e.ctrlKey?function(){window.open(d)}:function(){window.location.href=d}}}}},D=function(){jQuery("#"+g).replaceWith(['<p id="temporary_list_placeholder_',h,'"></p>','<table id="'+a.jqgrid.id+'"',' cellpadding="0" cellspacing="0"></table>','<div id="'+a.jqgrid.pager.id+'"',' style="text-align:center"></div>'].join(""))},A=function(){var b="",d=0,e=function(){var r="?";if(window.location.href.indexOf("?")!==
-1)r="&";jQuery.ajax({async:true,cache:false,url:[window.location.href,r,"fmt=json&limit=150",b===""?"":"&start="+b,"&idx=",h].join(""),timeout:6E4,tryCount:1,retryLimit:5,error:function(c){if(c.status==500){this.tryCount++;if(this.tryCount<=this.retryLimit)jQuery.ajax(this);else{jQuery("#temporary_list_placeholder_"+h).html('<span style="color:red">Error retrieving data: please refresh the list or the whole page to try again</span>');jQuery("#load_"+a.jqgrid.id).hide()}}else{jQuery("#temporary_list_placeholder_"+
h).html('<span style="color:red">Error retrieving data: please refresh the list or the whole page to try again</span>');jQuery("#load_"+a.jqgrid.id).hide()}},success:function(c){c=JSON.parse(c);var k=d>0,j=!c.data[b].length;if(c.data[b]!==undefined&&(!k||!j)){if(a.configuration===null)a.configuration=c.configuration;if(a.operations===null)a.operations=c.operations;c=c.data[b];jQuery.each(c,function(){a.data.data.push(this.columns);a.data.all_data.push(this)});a.jqgrid.object===null?w():a.jqgrid.object.trigger("reloadGrid");
if(c[c.length-1]!==undefined){b=c[c.length-1].columns.key;setTimeout(e,100);d++}else{jQuery("#temporary_list_placeholder_"+h).remove();jQuery("#load_"+a.jqgrid.id).hide()}}else{jQuery("#temporary_list_placeholder_"+h).remove();jQuery("#load_"+a.jqgrid.id).hide();jQuery("#"+a.jqgrid.id)[0].triggerToolbar();jQuery.each(a.configuration.colModel,function(f,i){i.editable!==undefined&&i.editable===true&&a.jqgrid.editable_columns.push(i.name)});jQuery("#t_"+a.jqgrid.id).children().remove();a.operations!==
undefined&&a.operations.buttons!==undefined&&jQuery.each(a.operations.buttons,function(f,i){f=a.jqgrid.id+"_buttonOp_"+i.id;jQuery("#t_"+a.jqgrid.id).append("<input type='button' value='"+i.caption+"' style='float:left' id='"+f+"'/>");i.parameters.idx=h;if(i.type!=="post_edit"){i.real_bounds=i.bounds;var n=i.real_bounds.indexOf("all");if(n!==-1)i.real_bounds[n]=a.jqgrid.object.jqGrid("getGridParam","records");i.parameters.real_bounds=i.real_bounds}if(i.type==="post_edit"||i.real_bounds[0]>0)jQuery("#"+
f).attr("disabled","disabled");i.parameters.button_id=i.id;jQuery("#"+f).click(v.global_button_functions[i.type](i.parameters));i.type=="redirect_custom"&&jQuery("#"+f).data("melange",{click:v.global_button_functions[i.type](i.parameters)})});var q=a.jqgrid.object.jqGrid("getGridParam","multiselect");if(a.operations!==undefined&&a.operations.row!==undefined&&!C(a.operations.row)){jQuery("body").live("mouseover",function(){q?jQuery("#"+a.jqgrid.id+" tbody tr td:gt(0)").css("cursor","pointer"):jQuery("#"+
a.jqgrid.id+" tbody tr td").css("cursor","pointer")});c=a.operations.row;c.parameters.idx=h;c.type=="redirect_custom"&&a.jqgrid.object.data("melange",{rowsel:v.row_functions[c.type](c.parameters)});a.jqgrid.object.jqGrid("setGridParam",{onCellSelect:function(f,i,n,l){if(!(q&&i==0)){f=jQuery("#"+a.jqgrid.id).jqGrid("getRowData",f);f=t.from(a.data.all_data).equals("columns.key",f.key).select()[0];i=a.jqgrid.object.data("melange").rowsel;i(f.operations.row.link,l)()}}})}jQuery("#t_"+a.jqgrid.id).css("padding-bottom",
"3px");jQuery("#t_"+a.jqgrid.id).append("<input type='button' value='CSV Export' style='float:right' id='csvexport_"+a.jqgrid.id+"'/>");jQuery("#csvexport_"+a.jqgrid.id).click(function(){var f=[];f[0]=[];if(a.data.data[0]!==undefined||a.data.filtered_data[0]!==undefined){var i=a.data.filtered_data||a.data.data;jQuery.each(a.configuration.colNames,function(l,z){l=z;l=l.replace(/\"|&quot;|&#34;/g,'""');if(l.indexOf(",")!==-1||l.indexOf('"')!==-1||l.indexOf("\r\n")!==-1)l='"'+l+'"';f[0].push(l)});f[0]=
f[0].join(",");var n=[];jQuery.each(a.configuration.colModel,function(l,z){n.push(z.name)});jQuery.each(i,function(l,z){f[f.length]=[];jQuery.each(n,function(s,G){s=z[G];if(s===null)s="";if(s===undefined)s="";s=s.toString();s=s.replace(/\"|&quot;|&#34;/g,'""');if(s.indexOf(",")!==-1||s.indexOf('"')!==-1||s.indexOf("\r\n")!==-1)s='"'+s+'"';f[f.length-1].push(s)});f[f.length-1]=f[f.length-1].join(",")});f=f.join("\r\n");jQuery("#csv_thickbox").remove();jQuery("body").append("<div id='csv_thickbox' style='display:none'><h3>Now you can copy and paste CSV data from the text area to a new file:</h3><textarea style='width:450px;height:250px'>"+
f+"</textarea></div>");tb_show("CSV export","#TB_inline?height=400&width=500&inlineId=csv_thickbox")}});jQuery("#t_"+a.jqgrid.id).append("<div style='float:right;margin-right:4px;'><input type='checkbox' id='regexp_"+a.jqgrid.id+"'/>RegExp Search</div>");jQuery("#regexp_"+a.jqgrid.id).click(function(){jQuery("#"+a.jqgrid.id).jqGrid().trigger("reloadGrid")});c=jQuery.Event("melange_list_loaded");c.list_object=a;a.jqgrid.object.trigger(c)}}})};setTimeout(e,100)};this.refreshData=function(){a.data={data:[],
all_data:[],filtered_data:null};A()};var w=function(){var b=jQuery.extend(a.configuration,{postData:{my_index:h},onSelectAll:v.enableDisableButtons,onSelectRow:v.enableDisableButtons}),d={caption:"",buttonicon:"ui-icon-calculator",onClickButton:function(){jQuery("#"+a.jqgrid.id).setColumns({colnameview:false,jqModal:true,ShrinkToFit:true});return false},position:"last",title:"Show/Hide Columns",cursor:"pointer"};jQuery("#"+a.jqgrid.id).jqGrid(jQuery.extend(a.jqgrid.options,b)).jqGrid("navGrid","#"+
a.jqgrid.pager.id,a.jqgrid.pager.options,{},{},{},{closeAfterSearch:true,multipleSearch:true},{}).jqGrid("navButtonAdd","#"+a.jqgrid.pager.id,d);jQuery("#"+a.jqgrid.id).jqGrid("filterToolbar",{});jQuery("#load_"+a.jqgrid.id).closest("div").css("line-height","100%");jQuery("#load_"+a.jqgrid.id).html("<img src='/soc/content/images/jqgrid_loading.gif'></img>");jQuery("#load_"+a.jqgrid.id).show();a.jqgrid.object=jQuery("#"+a.jqgrid.id)};this.getDiv=function(){return g};this.getIdx=function(){return h};
(function(){jQuery(function(){if(jQuery("#"+g).length===0)throw new x.error.divNotExistent("Div "+g+" is not existent");a.jqgrid.id="jqgrid_"+g;a.jqgrid.pager.id="jqgrid_pager_"+g;a.jqgrid.options=jQuery.extend(y,{pager:"#"+a.jqgrid.pager.id});a.jqgrid.pager.options=u;o.add(a);D();w();A()})})()}if(window.melange===undefined)throw new Error("Melange not loaded");var x=window.melange;if(window.jLinq===undefined)throw new Error("jLinq not loaded");var t=window.jLinq;x.list=window.melange.list=function(){return new x.list};
var H=x.logging.debugDecorator(x.list);x.error.createErrors(["listIndexNotValid","divNotExistent","indexAlreadyExistent"]);var B=[];B[0]={configuration:{colNames:['yo"Key',"Link, ID","Name","Program Owner","Read"],colModel:[{name:"key",index:"key",resizable:true,hidden:true},{name:"link_id",index:"link_id",resizable:true,hidden:true},{name:"name",index:"name",resizable:true},{name:"program_owner",index:"program_owner",resizable:true},{name:"read",index:"read",resizable:true,stype:"select",editoptions:{value:":All;^Read$:Posts Read;^Not Read$:Posts Unread"}}],
rowNum:4,rowList:[4,8],autowidth:true,sortname:"link_id",sortorder:"asc",height:"auto",multiselect:true,toolbar:[true,"top"]},operations:{buttons:[{bounds:[0,"all"],id:"bulk_process",caption:"Bulk Accept/Reject Organizations",type:"post",parameters:{url:""}},{bounds:[0,"all"],id:"add",caption:"Add a user",type:"redirect_simple",parameters:{link:"http://add1",new_window:true}},{bounds:[1,1],id:"edit",caption:"Edit user(s)",type:"redirect_custom",parameters:{new_window:true}},{bounds:[1,"all"],id:"delete",
caption:"Delete user(s)",type:"post",parameters:{url:"/user/roles",keys:["key","link_id"],refresh:"table"}},{bounds:[0,"all"],id:"dummy_0_all",caption:"Test 0-all range in POST",type:"post",parameters:{url:"/user/roles",keys:["key","link_id"],refresh:"table"}},{bounds:[0,"all"],id:"dummy_post_redirect",caption:"Test POST redirect",type:"post",parameters:{url:"/user/roles",keys:["key","link_id"],redirect:"true"}}],row:{type:"redirect_custom",parameters:{new_window:true}}},data:{"":[{columns:{key:"key_test",
link_id:"test",name:"Test Example",program_owner:"Google",read:"Read"},operations:{buttons:{edit:{caption:"Edit key_test user",link:"http://edit1"}},row:{link:"http://my_row_edit_link"}}},{columns:{key:"key_test2",link_id:"test2",name:"Test Example",program_owner:"GooglePlex",read:"Not Read"},operations:{edit:{caption:"Edit key_test2 user",link:"http://edit2"}}}],key_test2:[]}};B[1]={configuration:{colNames:["Key","Link ID","Name","Rank","Program Owner"],colModel:[{name:"key",index:"key",resizable:true},
{name:"link_id",index:"link_id",resizable:true},{name:"name",index:"name",resizable:true},{name:"rank",index:"rank",resizable:true,sorttype:"integer"},{name:"program_owner",index:"program_owner",resizable:true}],rowNum:4,rowList:[4,8],autowidth:true,sortname:"link_id",sortorder:"asc",toolbar:[true,"top"]},data:{"":[{columns:{key:"key_test3",link_id:"test3",name:"Mentor Test Example",rank:"10",program_owner:"melange"},operations:{edit:{caption:"Edit a user",link:"http://edit",new_window:true}}},{columns:{key:"key_test4",
link_id:"test4",name:"Mentor Test Example",rank:"12",program_owner:"google1"},operations:{edit:{caption:"Edit a user",link:"http://edit",new_window:true}}}],key_test4:[{columns:{key:"key_test5",link_id:"test5",name:"Mentor Test Example Loaded Incrementally",rank:"1",program_owner:"google1"},operations:{edit:{caption:"Edit a user",link:"http://edit",new_window:true}}}],key_test5:[{columns:{key:"key_test6",link_id:"test6",name:"Mentor Test Example Loaded Incrementally 2",rank:"2",program_owner:"google1"},
operations:{edit:{caption:"Edit a user",link:"http://edit",new_window:true}}}]}};B[2]={configuration:{colNames:["Key","Link ID","Name","Program Owner"],colModel:[{name:"key",index:"key",resizable:true},{name:"link_id",index:"link_id",resizable:true},{name:"name",index:"name",resizable:true},{name:"program_owner",index:"program_owner",resizable:true}],rowNum:4,rowList:[4,8],autowidth:true,sortname:"link_id",sortorder:"asc",toolbar:[true,"top"]},data:{"":[{columns:{key:"key_test7",link_id:"test7",name:"Admin Test Example",
program_owner:"melange"},operations:{edit:{caption:"Edit a user",link:"http://edit",new_window:true}}},{columns:{key:"key_test8",link_id:"test8",name:"Admin Test Example",program_owner:"google1"},operations:{edit:{caption:"Edit a user",link:"http://edit",new_window:true}}}],key_test8:[{columns:{key:"key_test9",link_id:"test9",name:"Admin Test Example Loaded Incrementally",program_owner:"google1"},operations:{edit:{caption:"Edit a user",link:"http://edit",new_window:true}}}]}};B[3]={configuration:{colNames:["Key",
"Link ID","Name","Program Owner"],colModel:[{name:"key",index:"key",resizable:true},{name:"link_id",index:"link_id",resizable:true},{name:"name",index:"name",resizable:true},{name:"program_owner",index:"program_owner",resizable:true}],rowNum:4,rowList:[4,8],autowidth:true,sortname:"link_id",sortorder:"asc",toolbar:[true,"top"]},data:{"":[]}};var C=function(g){for(var h in g)return false;return true},F=function(g){var h=g.my_index,p=o.get(h).data.data,m=p,a="",y={eq:{method:"equals",not:false},ne:{method:"equals",
not:true},lt:{method:"less",not:false},le:{method:"lessEquals",not:false},gt:{method:"greater",not:false},ge:{method:"greaterEquals",not:false},bw:{method:"startsWith",not:false},bn:{method:"startsWith",not:true},ew:{method:"endsWith",not:false},en:{method:"endsWith",not:true},cn:{method:"contains",not:false},nc:{method:"contains",not:true},"in":{method:"match",not:false},ni:{method:"match",not:true}};if(g._search&&g.filters){var u=JSON.parse(g.filters);if(u.rules[0].data!==""){a=u.groupOp;if(a===
"OR")m={};jQuery.each(u.rules,function(d,e){if(e.op==="in"||e.op==="ni")e.data=e.data.split(",").join("|");m=y[e.op].not?a==="OR"?t.from(m).union(t.from(p).not()[y[e.op].method](e.field,e.data).select()).select():t.from(m).not()[y[e.op].method](e.field,e.data).select():a==="OR"?t.from(m).union(t.from(p)[y[e.op].method](e.field,e.data).select()).select():t.from(m)[y[e.op].method](e.field,e.data).select()})}}else p[0]!==undefined&&jQuery.each(p[0],function(d){if(g[d]!==undefined){var e=jQuery("#regexp_"+
o.get(h).jqgrid.id).is(":checked"),r=false;jQuery.each(o.get(h).configuration.colModel,function(c,k){if(k.editoptions!==undefined&&d===k.name)r=true});m=e||r?t.from(m).match(d,g[d]).select():t.from(m).contains(d,g[d]).select()}});var v=g.sidx;u=g.sord;jQuery.each(o.get(h).configuration.colModel,function(d,e){if(e.name===v&&(e.sorttype==="integer"||e.sorttype==="int"))jQuery.each(m,function(r,c){r=parseInt(c[v],10);isNaN(r)||(c[v]=r)})});u=u==="asc"?"":"-";if(m.length>0)m=t.from(m).ignoreCase().orderBy(u+
v).select();o.get(h).data.filtered_data=m;if(g.rows===-1)g.rows=o.get(h).data.filtered_data.length;u=(g.page-1)*g.rows;for(var D=g.page*g.rows-1,A={page:g.page,total:m.length===0?0:Math.ceil(m.length/g.rows),records:m.length,rows:[]},w=u;w<=D;w++)if(m[w]!==undefined){var b=[];p[0]!==undefined&&jQuery.each(o.get(h).configuration.colModel,function(d,e){b.push(m[w][e.name])});A.rows.push({key:m[w].key,cell:b})}jQuery("#"+o.get(h).jqgrid.id)[0].addJSONData(A)},o=function(){var g=[];return{add:function(h){g[h.getIdx()]=
h},get:function(h){return g[h]!==undefined?g[h]:null},getAll:function(){return jQuery.extend({},g)},isExistent:function(h){return g[h]!==undefined?true:false}}}();H.loadList=function(g,h,p){p=parseInt(p,10);h=JSON.parse(h);if(isNaN(p)||p<0)throw new x.error.listIndexNotValid("List index "+p+" is not valid");if(o.isExistent(p))throw new x.error.indexAlreadyExistent("Index "+p+" is already existent");new E(g,p,h.configuration,h.operations)}})();
