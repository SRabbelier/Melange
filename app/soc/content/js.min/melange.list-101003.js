(function(){function D(h,i,p,m){var b=this,y={datatype:E,viewrecords:true},t={edit:false,add:false,del:false,afterRefresh:function(){b.refreshData();b.jqgrid.object.trigger("reloadGrid")}};h=h;i=i;this.configuration=p;this.operations=m;this.jqgrid={id:null,object:null,options:null,last_selected_row:null,editable_columns:[],dirty_fields:{},pager:{id:null,options:null}};this.data={data:[],all_data:[],filtered_data:null};var v={enableDisableButtons:function(a){return function(c){function d(l){var k=
jQuery("#"+a.jqgrid.id).jqGrid("getRowData",l),g=s.from(a.data.all_data).equals("columns.key",k.key).select()[0];if(a.jqgrid.dirty_fields[k.key]===undefined)a.jqgrid.dirty_fields[k.key]=[];var e=[],u=[];jQuery.each(k,function(j,r){r!=g.columns[j]?e.push(j):u.push(j)});jQuery.each(e,function(j,r){jQuery.inArray(r,a.jqgrid.dirty_fields[k.key])===-1&&a.jqgrid.dirty_fields[k.key].push(r)});jQuery.each(u,function(j,r){j=jQuery.inArray(r,a.jqgrid.dirty_fields[k.key]);j!==-1&&a.jqgrid.dirty_fields[k.key].splice(j,
1)});a.jqgrid.dirty_fields[k.key].length===0&&delete a.jqgrid.dirty_fields[k.key];jQuery.each(a.operations.buttons,function(j,r){if(r.type==="post_edit"){j=jQuery("#"+a.jqgrid.id+"_buttonOp_"+r.id);C(a.jqgrid.dirty_fields)?j.attr("disabled","disabled"):j.removeAttr("disabled")}})}var q=a.jqgrid.object.jqGrid("getGridParam","multiselect")?"selarrrow":"selrow",f=a.jqgrid.object.jqGrid("getGridParam",q);if(!f instanceof Array)f=[f];if(f.length===1)if(c&&c!==a.jqgrid.last_selected_row){jQuery("#"+a.jqgrid.id).restoreRow(a.jqgrid.last_selected_row);
jQuery("#"+a.jqgrid.id).jqGrid("editRow",c,true,null,null,"clientArray",null,d);a.jqgrid.last_selected_row=c}jQuery.each(a.operations.buttons,function(l,k){l=jQuery("#"+a.jqgrid.id+"_buttonOp_"+k.id);if(k.type!=="post_edit")if(f.length>=k.real_bounds[0]&&f.length<=k.real_bounds[1]){l.removeAttr("disabled");if(k.real_bounds[0]===1&&k.real_bounds[1]===1&&l.data("melange")!==undefined){var g=a.jqgrid.object.jqGrid("getRowData",f[0]);g=s.from(a.data.all_data).equals("columns.key",g.key).select()[0];var e=
l.data("melange").click;l.click(e(g.operations.buttons[k.id].link));l.attr("value",g.operations.buttons[k.id].caption)}}else l.attr("disabled","disabled")})}}(b),global_button_functions:{redirect_simple:function(a){return a.new_window?function(){window.open(a.link)}:function(){window.location.href=a.link}},redirect_custom:function(a){return function(c){return a.new_window?function(){window.open(c)}:function(){window.location.href=c}}},post:function(a){return function(){var c=n.get(a.idx).jqgrid.object.jqGrid("getGridParam",
"multiselect")?"selarrrow":"selrow";c=n.get(a.idx).jqgrid.object.jqGrid("getGridParam",c);c instanceof Array||(c=c===null?[]:[c]);var d=[];if(!(c.length<a.real_bounds[0]||c.length>a.real_bounds[1])){jQuery.each(c,function(q,f){var l=jQuery("#"+n.get(a.idx).jqgrid.id).jqGrid("getRowData",f);s.from(n.get(a.idx).all_data).equals("columns.key",l.key).select();var k={};jQuery.each(a.keys,function(g,e){k[e]=l[e]});d.push(k)});if(a.url==="")a.url=window.location.href;jQuery.post(a.url,{xsrf_token:window.xsrf_token,
idx:a.idx,button_id:a.button_id,data:JSON.stringify(d)},function(q){if(a.redirect=="true")try{var f=JSON.parse(q);if(f.data.url!==undefined)window.location.href=f.data.url}catch(l){}if(a.refresh=="table"){n.get(a.idx).refreshData();jQuery("#"+n.get(a.idx).jqgrid.id).trigger("reloadGrid")}})}}},post_edit:function(a){return function(){var c=n.get(a.idx).jqgrid,d={};if(!(c.editable_columns.length===0&&C(c.dirty_fields))){for(var q=c.object.jqGrid("getGridParam","records"),f=1;f<=q;f++){var l=jQuery("#"+
c.id).jqGrid("getRowData",f);if(c.dirty_fields[l.key]!==undefined){d[l.key]={};jQuery.each(c.dirty_fields[l.key],function(k,g){d[l.key][g]=l[g]})}}if(a.url==="")a.url=window.location.href;jQuery.post(a.url,{xsrf_token:window.xsrf_token,idx:a.idx,button_id:a.button_id,data:JSON.stringify(d)},function(k){if(a.redirect=="true")try{var g=JSON.parse(k);if(g.data.url!==undefined)window.location.href=g.data.url}catch(e){}if(a.refresh=="table"){n.get(a.idx).refreshData();jQuery("#"+n.get(a.idx).jqgrid.id).trigger("reloadGrid")}})}}}},
row_functions:{redirect_custom:function(a){return function(c,d){return a.new_window||d.which===2||d.which===1&&d.ctrlKey?function(){window.open(c)}:function(){window.location.href=c}}}}},B=function(){jQuery("#"+h).replaceWith(['<p id="temporary_list_placeholder_',i,'"></p>','<table id="'+b.jqgrid.id+'"',' cellpadding="0" cellspacing="0"></table>','<div id="'+b.jqgrid.pager.id+'"',' style="text-align:center"></div>'].join(""))},z=function(){var a="",c=0,d=function(){var q="?";if(window.location.href.indexOf("?")!==
-1)q="&";jQuery.ajax({async:true,cache:false,url:[window.location.href,q,"fmt=json&limit=150",a===""?"":"&start="+a,"&idx=",i].join(""),timeout:6E4,tryCount:1,retryLimit:5,error:function(f){if(f.status==500){this.tryCount++;if(this.tryCount<=this.retryLimit)jQuery.ajax(this);else{jQuery("#temporary_list_placeholder_"+i).html('<span style="color:red">Error retrieving data: please refresh the list or the whole page to try again</span>');jQuery("#load_"+b.jqgrid.id).hide()}}else{jQuery("#temporary_list_placeholder_"+
i).html('<span style="color:red">Error retrieving data: please refresh the list or the whole page to try again</span>');jQuery("#load_"+b.jqgrid.id).hide()}},success:function(f){f=JSON.parse(f);var l=c>0,k=!f.data[a].length;if(f.data[a]!==undefined&&(!l||!k)){if(b.configuration===null)b.configuration=f.configuration;if(b.operations===null)b.operations=f.operations;f=f.data[a];jQuery.each(f,function(){b.data.data.push(this.columns);b.data.all_data.push(this)});b.jqgrid.object===null?w():b.jqgrid.object.trigger("reloadGrid");
if(f[f.length-1]!==undefined){a=f[f.length-1].columns.key;setTimeout(d,100);c++}else{jQuery("#temporary_list_placeholder_"+i).remove();jQuery("#load_"+b.jqgrid.id).hide()}}else{jQuery("#temporary_list_placeholder_"+i).remove();jQuery("#load_"+b.jqgrid.id).hide();jQuery("#"+b.jqgrid.id)[0].triggerToolbar();jQuery.each(b.configuration.colModel,function(g,e){e.editable!==undefined&&e.editable===true&&b.jqgrid.editable_columns.push(e.name)});jQuery("#t_"+b.jqgrid.id).children().remove();b.operations!==
undefined&&b.operations.buttons!==undefined&&jQuery.each(b.operations.buttons,function(g,e){g=b.jqgrid.id+"_buttonOp_"+e.id;jQuery("#t_"+b.jqgrid.id).append("<input type='button' value='"+e.caption+"' style='float:left' id='"+g+"'/>");e.parameters.idx=i;if(e.type!=="post_edit"){e.real_bounds=e.bounds;var u=e.real_bounds.indexOf("all");if(u!==-1)e.real_bounds[u]=b.jqgrid.object.jqGrid("getGridParam","records");e.parameters.real_bounds=e.real_bounds}if(e.type==="post_edit"||e.real_bounds[0]>0)jQuery("#"+
g).attr("disabled","disabled");e.parameters.button_id=e.id;jQuery("#"+g).click(v.global_button_functions[e.type](e.parameters));e.type=="redirect_custom"&&jQuery("#"+g).data("melange",{click:v.global_button_functions[e.type](e.parameters)})});jQuery.each(b.data.all_data,function(g,e){e.operations!==undefined&&e.operations.row!==undefined&&e.operations.row.link!==undefined&&jQuery.each(e.columns,function(u,j){if(j!==null&&j.toString().match(/<a\b[^>]*>.*<\/a>/)===null)b.data.all_data[g].columns[u]=
'<a style="display:block;" href="'+e.operations.row.link+'" class="listsnoul">'+j+"</a>"})});b.jqgrid.object.trigger("reloadGrid");jQuery("#t_"+b.jqgrid.id).css("padding-bottom","3px");jQuery("#t_"+b.jqgrid.id).append("<input type='button' value='CSV Export' style='float:right' id='csvexport_"+b.jqgrid.id+"'/>");jQuery("#csvexport_"+b.jqgrid.id).click(function(){var g=[];g[0]=[];if(b.data.data[0]!==undefined||b.data.filtered_data[0]!==undefined){var e=b.data.filtered_data||b.data.data;jQuery.each(b.configuration.colNames,
function(j,r){j=r;j=j.replace(/\"|&quot;|&#34;/g,'""');if(j.indexOf(",")!==-1||j.indexOf('"')!==-1||j.indexOf("\r\n")!==-1)j='"'+j+'"';g[0].push(j)});g[0]=g[0].join(",");var u=[];jQuery.each(b.configuration.colModel,function(j,r){u.push(r.name)});jQuery.each(e,function(j,r){g[g.length]=[];jQuery.each(u,function(o,F){o=r[F];if(o===null)o="";if(o===undefined)o="";o=o.toString();if(jQuery(o).parent().find("a.listsnoul").length)o=/<a\b[^>]*>(.*?)<\/a>/.exec(o)[1];o=o.replace(/\"|&quot;|&#34;/g,'""');
if(o.indexOf(",")!==-1||o.indexOf('"')!==-1||o.indexOf("\r\n")!==-1)o='"'+o+'"';g[g.length-1].push(o)});g[g.length-1]=g[g.length-1].join(",")});g=g.join("\r\n");jQuery("#csv_thickbox").remove();jQuery("body").append("<div id='csv_thickbox' style='display:none'><h3>Now you can copy and paste CSV data from the text area to a new file:</h3><textarea style='width:450px;height:250px'>"+g+"</textarea></div>");tb_show("CSV export","#TB_inline?height=400&width=500&inlineId=csv_thickbox")}});jQuery("#t_"+
b.jqgrid.id).append("<div style='float:right;margin-right:4px;'><input type='checkbox' id='regexp_"+b.jqgrid.id+"'/>RegExp Search</div>");jQuery("#regexp_"+b.jqgrid.id).click(function(){jQuery("#"+b.jqgrid.id).jqGrid().trigger("reloadGrid")});f=jQuery.Event("melange_list_loaded");f.list_object=b;b.jqgrid.object.trigger(f)}}})};setTimeout(d,100)};this.refreshData=function(){b.data={data:[],all_data:[],filtered_data:null};z()};var w=function(){var a=jQuery.extend(b.configuration,{postData:{my_index:i},
onSelectAll:v.enableDisableButtons,onSelectRow:v.enableDisableButtons}),c={caption:"",buttonicon:"ui-icon-calculator",onClickButton:function(){jQuery("#"+b.jqgrid.id).setColumns({colnameview:false,jqModal:true,ShrinkToFit:true});return false},position:"last",title:"Show/Hide Columns",cursor:"pointer"};jQuery("#"+b.jqgrid.id).jqGrid(jQuery.extend(b.jqgrid.options,a)).jqGrid("navGrid","#"+b.jqgrid.pager.id,b.jqgrid.pager.options,{},{},{},{closeAfterSearch:true,multipleSearch:true},{}).jqGrid("navButtonAdd",
"#"+b.jqgrid.pager.id,c);jQuery("#"+b.jqgrid.id).jqGrid("filterToolbar",{});jQuery("#load_"+b.jqgrid.id).closest("div").css("line-height","100%");jQuery("#load_"+b.jqgrid.id).html("<img src='/soc/content/images/jqgrid_loading.gif'></img>");jQuery("#load_"+b.jqgrid.id).show();b.jqgrid.object=jQuery("#"+b.jqgrid.id)};this.getDiv=function(){return h};this.getIdx=function(){return i};(function(){jQuery(function(){if(jQuery("#"+h).length===0)throw new x.error.divNotExistent("Div "+h+" is not existent");
b.jqgrid.id="jqgrid_"+h;b.jqgrid.pager.id="jqgrid_pager_"+h;b.jqgrid.options=jQuery.extend(y,{pager:"#"+b.jqgrid.pager.id});b.jqgrid.pager.options=t;n.add(b);B();w();z()})})()}if(window.melange===undefined)throw new Error("Melange not loaded");var x=window.melange;if(window.jLinq===undefined)throw new Error("jLinq not loaded");var s=window.jLinq;x.list=window.melange.list=function(){return new x.list};var G=x.logging.debugDecorator(x.list);x.error.createErrors(["listIndexNotValid","divNotExistent",
"indexAlreadyExistent"]);var A=[];A[0]={configuration:{colNames:['yo"Key',"Link, ID","Name","Program Owner","Read"],colModel:[{name:"key",index:"key",resizable:true,hidden:true},{name:"link_id",index:"link_id",resizable:true,hidden:true},{name:"name",index:"name",resizable:true},{name:"program_owner",index:"program_owner",resizable:true},{name:"read",index:"read",resizable:true,stype:"select",editoptions:{value:":All;^Read$:Posts Read;^Not Read$:Posts Unread"}}],rowNum:4,rowList:[4,8],autowidth:true,
sortname:"link_id",sortorder:"asc",height:"auto",multiselect:true,toolbar:[true,"top"]},operations:{buttons:[{bounds:[0,"all"],id:"bulk_process",caption:"Bulk Accept/Reject Organizations",type:"post",parameters:{url:""}},{bounds:[0,"all"],id:"add",caption:"Add a user",type:"redirect_simple",parameters:{link:"http://add1",new_window:true}},{bounds:[1,1],id:"edit",caption:"Edit user(s)",type:"redirect_custom",parameters:{new_window:true}},{bounds:[1,"all"],id:"delete",caption:"Delete user(s)",type:"post",
parameters:{url:"/user/roles",keys:["key","link_id"],refresh:"table"}},{bounds:[0,"all"],id:"dummy_0_all",caption:"Test 0-all range in POST",type:"post",parameters:{url:"/user/roles",keys:["key","link_id"],refresh:"table"}},{bounds:[0,"all"],id:"dummy_post_redirect",caption:"Test POST redirect",type:"post",parameters:{url:"/user/roles",keys:["key","link_id"],redirect:"true"}}],row:{type:"redirect_custom",parameters:{new_window:true}}},data:{"":[{columns:{key:"key_test",link_id:"test",name:"Test Example",
program_owner:"Google",read:"Read"},operations:{buttons:{edit:{caption:"Edit key_test user",link:"http://edit1"}},row:{link:"http://my_row_edit_link"}}},{columns:{key:"key_test2",link_id:"test2",name:"Test Example",program_owner:"GooglePlex",read:"Not Read"},operations:{edit:{caption:"Edit key_test2 user",link:"http://edit2"}}}],key_test2:[]}};A[1]={configuration:{colNames:["Key","Link ID","Name","Rank","Program Owner"],colModel:[{name:"key",index:"key",resizable:true},{name:"link_id",index:"link_id",
resizable:true},{name:"name",index:"name",resizable:true},{name:"rank",index:"rank",resizable:true,sorttype:"integer"},{name:"program_owner",index:"program_owner",resizable:true}],rowNum:4,rowList:[4,8],autowidth:true,sortname:"link_id",sortorder:"asc",toolbar:[true,"top"]},data:{"":[{columns:{key:"key_test3",link_id:"test3",name:"Mentor Test Example",rank:"10",program_owner:"melange"},operations:{edit:{caption:"Edit a user",link:"http://edit",new_window:true}}},{columns:{key:"key_test4",link_id:"test4",
name:"Mentor Test Example",rank:"12",program_owner:"google1"},operations:{edit:{caption:"Edit a user",link:"http://edit",new_window:true}}}],key_test4:[{columns:{key:"key_test5",link_id:"test5",name:"Mentor Test Example Loaded Incrementally",rank:"1",program_owner:"google1"},operations:{edit:{caption:"Edit a user",link:"http://edit",new_window:true}}}],key_test5:[{columns:{key:"key_test6",link_id:"test6",name:"Mentor Test Example Loaded Incrementally 2",rank:"2",program_owner:"google1"},operations:{edit:{caption:"Edit a user",
link:"http://edit",new_window:true}}}]}};A[2]={configuration:{colNames:["Key","Link ID","Name","Program Owner"],colModel:[{name:"key",index:"key",resizable:true},{name:"link_id",index:"link_id",resizable:true},{name:"name",index:"name",resizable:true},{name:"program_owner",index:"program_owner",resizable:true}],rowNum:4,rowList:[4,8],autowidth:true,sortname:"link_id",sortorder:"asc",toolbar:[true,"top"]},data:{"":[{columns:{key:"key_test7",link_id:"test7",name:"Admin Test Example",program_owner:"melange"},
operations:{edit:{caption:"Edit a user",link:"http://edit",new_window:true}}},{columns:{key:"key_test8",link_id:"test8",name:"Admin Test Example",program_owner:"google1"},operations:{edit:{caption:"Edit a user",link:"http://edit",new_window:true}}}],key_test8:[{columns:{key:"key_test9",link_id:"test9",name:"Admin Test Example Loaded Incrementally",program_owner:"google1"},operations:{edit:{caption:"Edit a user",link:"http://edit",new_window:true}}}]}};A[3]={configuration:{colNames:["Key","Link ID",
"Name","Program Owner"],colModel:[{name:"key",index:"key",resizable:true},{name:"link_id",index:"link_id",resizable:true},{name:"name",index:"name",resizable:true},{name:"program_owner",index:"program_owner",resizable:true}],rowNum:4,rowList:[4,8],autowidth:true,sortname:"link_id",sortorder:"asc",toolbar:[true,"top"]},data:{"":[]}};var C=function(h){for(var i in h)return false;return true},E=function(h){var i=h.my_index,p=n.get(i).data.data,m=p,b="",y={eq:{method:"equals",not:false},ne:{method:"equals",
not:true},lt:{method:"less",not:false},le:{method:"lessEquals",not:false},gt:{method:"greater",not:false},ge:{method:"greaterEquals",not:false},bw:{method:"startsWith",not:false},bn:{method:"startsWith",not:true},ew:{method:"endsWith",not:false},en:{method:"endsWith",not:true},cn:{method:"contains",not:false},nc:{method:"contains",not:true},"in":{method:"match",not:false},ni:{method:"match",not:true}};if(h._search&&h.filters){var t=JSON.parse(h.filters);if(t.rules[0].data!==""){b=t.groupOp;if(b===
"OR")m={};jQuery.each(t.rules,function(c,d){if(d.op==="in"||d.op==="ni")d.data=d.data.split(",").join("|");m=y[d.op].not?b==="OR"?s.from(m).union(s.from(p).not()[y[d.op].method](d.field,d.data).select()).select():s.from(m).not()[y[d.op].method](d.field,d.data).select():b==="OR"?s.from(m).union(s.from(p)[y[d.op].method](d.field,d.data).select()).select():s.from(m)[y[d.op].method](d.field,d.data).select()})}}else p[0]!==undefined&&jQuery.each(p[0],function(c){if(h[c]!==undefined){var d=jQuery("#regexp_"+
n.get(i).jqgrid.id).is(":checked"),q=false;jQuery.each(n.get(i).configuration.colModel,function(f,l){if(l.editoptions!==undefined&&c===l.name)q=true});m=d||q?s.from(m).match(c,h[c]).select():s.from(m).contains(c,h[c]).select()}});var v=h.sidx;t=h.sord;jQuery.each(n.get(i).configuration.colModel,function(c,d){if(d.name===v&&(d.sorttype==="integer"||d.sorttype==="int"))jQuery.each(m,function(q,f){q=parseInt(f[v],10);isNaN(q)||(f[v]=q)})});t=t==="asc"?"":"-";if(m.length>0)m=s.from(m).ignoreCase().orderBy(t+
v).select();n.get(i).data.filtered_data=m;if(h.rows===-1)h.rows=n.get(i).data.filtered_data.length;t=(h.page-1)*h.rows;for(var B=h.page*h.rows-1,z={page:h.page,total:m.length===0?0:Math.ceil(m.length/h.rows),records:m.length,rows:[]},w=t;w<=B;w++)if(m[w]!==undefined){var a=[];p[0]!==undefined&&jQuery.each(n.get(i).configuration.colModel,function(c,d){a.push(m[w][d.name])});z.rows.push({key:m[w].key,cell:a})}jQuery("#"+n.get(i).jqgrid.id)[0].addJSONData(z)},n=function(){var h=[];return{add:function(i){h[i.getIdx()]=
i},get:function(i){return h[i]!==undefined?h[i]:null},getAll:function(){return jQuery.extend({},h)},isExistent:function(i){return h[i]!==undefined?true:false}}}();G.loadList=function(h,i,p){p=parseInt(p,10);i=JSON.parse(i);if(isNaN(p)||p<0)throw new x.error.listIndexNotValid("List index "+p+" is not valid");if(n.isExistent(p))throw new x.error.indexAlreadyExistent("Index "+p+" is already existent");new D(h,p,i.configuration,i.operations)}})();
