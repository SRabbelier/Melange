(function(){var g=window.melange;this.prototype=new g.templates._baseTemplate;this.prototype.constructor=g.templates._baseTemplate;g.templates._baseTemplate.apply(this,arguments);var h=this.context.difficulties,d=jQuery.extend(h,{});jQuery(function(){var b="";jQuery.each(h,function(a,c){b+=['<li id="li-existing-',a,'" class="handle">  <span id="existing-name-',a,'" class="place-edit-name">',c.name,'</span><br />  Value: <span id="existing-value-',a,'" class="place-edit-value">',c.value,'</span><input id="delete-existing-',
a,'" style="float:right" type="button" value="Delete" /></li>'].join("")});jQuery("#dynamic-add").html(b);jQuery.each(h,function(a){jQuery("#delete-existing-"+a).bind("click",i)});jQuery(".add-button").bind("click",function(){jQuery("#add_dialog").dialog("open")});jQuery("span[class^=place-edit]").inPlaceEdit({submit:j,cancel:k});jQuery("#dynamic-add").sortable({update:l});jQuery("#add_dialog").dialog({autoOpen:false,resizable:true,modal:true,buttons:{"Create new tag":function(){jQuery(this).dialog("close");
var a=d.length,c=jQuery("#new_name").val(),e=jQuery("#new_value").val();jQuery("#new_name").val("");jQuery("#new_value").val("");var f={name:c,value:e};d.push(f);jQuery.post(window.href,{xsrf_token:window.xsrf_token,operation:JSON.stringify({op:"add",data:[f]})});jQuery("#dynamic-add").append(['<li id="li-new-'+a+'" class="handle">','  <span id="new-name-',a,'" class="place-edit-name">',c,'</span><br />  Value: <span id="new-value-',a,'" class="place-edit-value">',e,'</span><input id="delete-new-"',
a,'" style="float:right" type="button" value="Delete" /></li>'].join(""));jQuery("#delete-new-"+a).bind("click",i);jQuery("#new-name-"+a+", #new-value-"+a).inPlaceEdit({submit:j,cancel:k})},Cancel:function(){jQuery("#new_name").val("");jQuery("#new_value").val("");jQuery(this).dialog("close")}}})});var l=function(){var b=[],a=jQuery("#dynamic-add").sortable("toArray");jQuery.each(a,function(c,e){c=e.match(/li-(.*?)-(\d*)/)[2];b.push(jQuery.extend({},d[c]))});jQuery.post(window.href,{xsrf_token:window.xsrf_token,
operation:JSON.stringify({op:"reorder",data:b})})},i=function(){var b=this.id.match(/delete-(.*?)-(\d*)/),a=b[2];jQuery("#li-"+b[1]+"-"+a).remove();b={name:d[a].name,value:d[a].value};delete d[a];jQuery.post(window.href,{xsrf_token:window.xsrf_token,operation:JSON.stringify({op:"delete",data:[b]})})},j=function(b,a,c){if(c===""){jQuery(".field",b).blur();return false}a=a.match(/(.*?)-(name|value)-(\d*)/);b=a[2];a=a[3];var e={name:d[a].name,value:d[a].value},f=jQuery.extend({},e);f[b]=c;d[a][b]=c;
jQuery.post(window.href,{xsrf_token:window.xsrf_token,operation:JSON.stringify({op:"change",data:[e,f]})});return true},k=function(){return true}})();
