(function(){function k(){g=0;jQuery.each(d,function(a,c){g+=Number(c.slots)})}function l(){k();var a=j-g;jQuery("#p_assigned_slots").html("<strong>Assigned slots:</strong> "+g);jQuery("#p_remaining_slots").html("<strong>Remaining slots:</strong> "+a)}function h(a){if(a){jQuery(a.data).each(function(c,b){jQuery("#id_spin_slot_count_"+b.link_id).val(b.slots);c=jLinq.from(e.data.data).equals("link_id",b.link_id).select()[0];c.slots_ass=b.slots;c.locked=b.locked;d[b.link_id]={slots:b.slots,locked:b.locked};
jQuery("#id_locked_slot_"+b.link_id).attr("checked",b.locked)});l()}jQuery("[id^=button_slot_]").removeAttr("disabled")}function m(){jQuery.getJSON(i+"?_="+(new Date).getTime(),function(a){a&&h(a)})}function n(){jQuery("#button_slot_allocation_recalculate").attr("disabled","disabled");var a=i+"?_="+(new Date).getTime();jQuery.postJSON(a,d,h)}function o(){jQuery("#button_slot_allocation_submit").attr("disabled","disabled");var a=i+"?submit=1&_="+(new Date).getTime();jQuery.postJSON(a,d,h)}function p(){jQuery("#button_slot_allocation_load").attr("disabled",
"disabled");var a=i+"?load=1&_="+(new Date).getTime();jQuery.postJSON(a,d,h)}function q(){var a=this,c=jQuery(a).attr("checked");a=a.id.match(/^id_locked_slot_(\w*)/)[1];d[a].locked=c;jLinq.from(e.data.data).equals("link_id",a).select()[0].locked=c}function r(){var a=this,c=a.id.match(/^id_spin_slot_count_(\w*)/)[1];d[c].slots=jQuery(a).val();jLinq.from(e.data.data).equals("link_id",c).select()[0].slots_ass=jQuery(a).val();k();l()}var f=window.melange;this.prototype=new f.templates._baseTemplate;
this.prototype.constructor=f.templates._baseTemplate;f.templates._baseTemplate.apply(this,arguments);f=this;var j=f.context.total_slots,i=f.context.return_url,g=0,d={},e;jQuery(function(){jQuery(document).bind("melange_list_loaded",function(a){e=a.list_object;a=e.jqgrid.object.jqGrid("getRowData");jQuery.each(a,function(c,b){b=b.link_id;e.jqgrid.object.jqGrid("setCell",c+1,"slots_ass",'<div class="slots" id="id_slot_count_container_'+b+'"><input type="text" id="id_spin_slot_count_'+b+'" size="3" value="0"/></div>',
null,null);jQuery("#id_spin_slot_count_"+b).bind("change",r);e.jqgrid.object.jqGrid("setCell",c+1,"locked",'<div class="locked" id="id_locked_slot_container_'+b+'"><input type="checkbox" id="id_locked_slot_'+b+'"/></div>',null,null);jQuery("#id_locked_slot_"+b).bind("change",q)});jQuery("[id^=id_spin_slot_count_]").spin({min:0,max:j});jQuery("<div class='tooltip'><div class='tooltip-body'><img src='/soc/content/images/purrInfo.png' alt='' /><h3>Slots</h3><p id='p_assigned_slots'></p><p id='p_remaining_slots'></p><p id='p_total_slots'></p></div><div class='tooltip-bottom'></div></div>").purr({usingTransparentPNG:true,
isSticky:true});jQuery("#p_total_slots").html("<strong>Max slots:</strong> "+j);jQuery("#button_slot_allocation_recalculate").bind("click",n);jQuery("#button_slot_allocation_submit").bind("click",o);jQuery("#button_slot_allocation_load").bind("click",p);m()})});jQuery.postJSON=function(a,c,b){jQuery.ajax({url:a,type:"POST",processData:true,data:{xsrf_token:window.xsrf_token,result:JSON.stringify(c)},contentType:"application/json",dataType:"json",success:b})}})();
